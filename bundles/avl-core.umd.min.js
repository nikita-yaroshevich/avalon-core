/**
 * @license Nikita Yaroshevich v2.0.0
 * (c) 2017 Nikita Yaroshevich https://github.com/nikita-yaroshevich/avl-core
 * License: MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/http"),require("lodash"),require("rxjs/Rx"),require("inflection"),require("@angular/forms"),require("@angular/common"),require("@angular/platform-browser")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/http","lodash","rxjs/Rx","inflection","@angular/forms","@angular/common","@angular/platform-browser"],e):e((t.avl=t.avl||{},t.avl.core=t.avl.core||{}),t.ng.core,t._angular_http,t.lodash,t.rxjs_Rx,t.inflection,t._angular_forms,t.ng.common,t._angular_platformBrowser)}(this,function(t,e,r,n,o,i,s,a,u){"use strict";function c(t){return Reflect.get(t,"__Entity")||{}}function p(t){return function(e){Reflect.defineProperty(e,"__Entity",{value:t,writable:!1})}}function f(t){return Reflect.get(t,"__Repository")||{}}function h(t){return function(e){Reflect.defineProperty(e,"__Repository",{value:t,writable:!1})}}function l(t){return Reflect.get(t,"__EntityManager")||{}}function d(t){return function(e){Reflect.defineProperty(e,"__EntityManager",{value:{baseUrl:t.baseUrl||"/",headers:t.headers||new r.Headers,params:t.params||new r.URLSearchParams,requestTransformer:t.requestTransformer,responseTransformer:t.responseTransformer},writable:!1})}}function m(t,e){return void 0===e&&(e="default"),(Reflect.get(t,"__Validators")||{})[e]||[]}function y(t){var e={name:t.name||"default",validator:t.validator||t};return function(t,r){var n=Reflect.get(t.constructor,"__Validators")||{};n[e.name]=n[e.name]||{},n[e.name][r]=n[e.name][r]||[],n[e.name][r]=n[e.name][r].concat(e.validator),Reflect.defineProperty(t.constructor,"__Validators",{value:n,writable:!0})}}function g(t,e){return void 0===e&&(e="default"),(Reflect.get(t,"__ValidatorsAsync")||{})[e]||{}}function v(t){var e={name:t.name||"default",validator:t.validator||t};return function(t,r){var n=Reflect.get(t.constructor,"__ValidatorsAsync")||{};n[e.name]=n[e.name]||{},n[e.name][r]=n[e.name][r]||[],n[e.name][r]=n[e.name][r].concat(e.validator),Reflect.defineProperty(t.constructor,"__ValidatorsAsync",{value:n,writable:!0})}}var b=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),_=function(t){function e(e){return t.call(this,e)||this}return b(e,t),e}(Error),w=function(t){function e(e){return t.call(this,e)||this}return b(e,t),e}(Error),P=function(t){function e(e){return t.call(this,e)||this}return b(e,t),e}(Error),E=function(t){function e(e){return t.call(this,e)||this}return b(e,t),e}(P),R=function(t){function e(e){return t.call(this,e)||this}return b(e,t),e}(Error),T=function(t){function e(e){return t.call(this,e)||this}return b(e,t),e}(Error),A=function(t){function e(e){return t.call(this,e)||this}return b(e,t),e}(Error),O=function(t){function e(e,r,n){var o=t.call(this,r)||this;return o.token=e,o.error=n,o}return b(e,t),e}(Error),C=function(){function t(t){this.interactor=t}return t.prototype.resolve=function(t,e){return this.interactor.findItems().then(function(t){return t})},t}(),U=function(){function t(t,r){this.em=t,this.options=r,this.events=new e.EventEmitter}return Object.defineProperty(t.prototype,"repository",{get:function(){return this._repository||(this._repository=this.em.getRepository(this.options.RepositoryClass||this.options.EntityClass)),this._repository},enumerable:!0,configurable:!0}),t.prototype.findItems=function(t){var e=this;return this.repository.getByCriteria(t).then(function(t){return t}).catch(function(t){return e.events.emit({type:"error",message:"Internal Error. Probably Connection Issue"}),Promise.reject(t)})},t.prototype.getItemByIndentity=function(t){var e=this;return this.repository.getById(t).catch(function(t){return e.events.emit({type:"error",message:"Internal Error. Probably Connection Issue"}),Promise.reject(t)})},t.prototype.removeItem=function(t){var e=this;return this.repository.delete(t).then(function(t){return e.events.emit({type:"success",message:"Removed successfully"}),t}).catch(function(t){return e.events.emit({type:"error",message:t.toString()}),Promise.reject(t)})},t.prototype.saveItem=function(t){var e=this;return this.repository.save(t).then(function(t){return e.events.emit({type:"success",message:"Saved successfully"}),t}).catch(function(t){return e.events.emit({type:"error",message:t.toString()}),Promise.reject(t)})},t.prototype.createEntity=function(){return new this.options.EntityClass},t}(),k=function(){function t(t,e){this.interactor=t,this.router=e}return Object.defineProperty(t.prototype,"repository",{get:function(){return this.interactor.repository},enumerable:!0,configurable:!0}),t.prototype.resolve=function(t,e){var r=this,n=t.params.id;return"new"!==n&&n?this.repository.getById(n).then(function(t){return t||(r.router.navigate(["../"]),null)}):Promise.resolve(this.interactor.createEntity())},t}(),I=function(){function t(t,e,r,n){this.interactor=t,this.route=e,this.router=r,this.location=n}return t.prototype.ngOnInit=function(){var t=this;this.route.data.subscribe(function(e){t.item=e.item,t.reset()})},t.prototype.save=function(t){var e,r=this;try{return e=t.getEntity(),this.loading.show(),this.interactor.saveItem(e).then(function(t){r.item=t,r.reset(),r.loading.hide()}).catch(function(t){r.loading.hide()})}catch(t){return this.loading.hide(),this.interactor.events.emit({type:"alert-error",message:t.toString()}),Promise.reject(t)}},t.prototype.delete=function(t){var e=this;this.interactor.removeItem(t).then(function(){e.location.back()})},t.prototype.reset=function(){this.form=this.getFormType(),this.form.buildForm(this.item)},t}();I.propDecorators={loading:[{type:e.ViewChild,args:["loading"]}]};var j=function(){function t(t,e,r){var n=this;this.interactor=t,this.route=e,this.router=r,this.route.data.subscribe(function(t){n.items=t.items})}return t.prototype.deleteItem=function(t){var e=this;this.interactor.removeItem(t).then(function(){e.interactor.findItems().then(function(t){e.items=t})})},t}(),S=function(){function t(){}return t}(),M=function(){function t(t,e,r){this.options=t,this.entity=r||{},this.criteria=e||{}}return t}(),q=function(){function t(t){this.cb=t}return t.prototype.transform=function(t,e){return this.cb(t,e)},t}(),D=function(){function t(t){if(this.transformers=[],t)if(Array.isArray(t))for(var e=0,r=t;e<r.length;e++){var n=r[e];n&&this.addTransformer(n)}else this.addTransformer(t)}return t.prototype.addTransformer=function(t,e){if(this.hasTransformer(t))throw new w;return t instanceof Function?this.transformers.push({transformer:new q(t),options:e}):this.transformers.push({transformer:t,options:e}),this},t.prototype.hasTransformer=function(t){return-1!==n.findIndex(this.transformers,function(e){return e.transformer===t||e.transformer.cb&&e.transformer.cb===t})},t.prototype.removeTransformer=function(t){var e=null;if(this.transformers=n.filter(this.transformers,function(r){return!!e||(!(r.transformer===t||r.transformer.cb&&r.transformer.cb===t)||(e=t,!1))}),null===e)throw new _("Transformer not founded");return e},t.prototype.getTransformers=function(){return this.transformers},t.prototype.transform=function(t,e){for(var r=t,o=0,i=this.transformers;o<i.length;o++){var s=i[o];r=s.transformer.transform(r,n.merge({},e,s.options))}return r},t}(),x=function(){function t(){}return t.prototype.createData=function(t,e,r){return Array.isArray(e)&&(e=new D(e)),e instanceof Function&&(e=new q(e)),e.transform(t,r)},t}(),F=function(){function t(t,e){this._injector=t,this.repositories=new Map,Reflect.has(this.constructor,"__EntityManager")&&(this.config=Reflect.get(this.constructor,"__EntityManager")),Object.assign(this.config,e)}return t.prototype.transformData=function(t,e){return(new x).createData(t,e)},t.prototype.getInjector=function(){return this._injector},t.prototype.getRepository=function(t,e){void 0===e&&(e={});var r=t.name,n={};if(Reflect.has(t,"__Entity")&&(n=Reflect.get(t,"__Entity"),n.repository&&(t=n.repository,r+="_"+t.name)),this.repositories.has(r))return this.repositories.get(r);var o=new t(Object.assign({},e,n));return o.setEntityManager(this),this.repositories.set(r,o),o},t}(),L=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),N=function(t){function e(e){var r=t.call(this,e)||this;return Object.assign(r,e),r}return L(e,t),e.prototype.merge=function(t){return new e({method:t&&null!=t.method?t.method:this.method,headers:t&&null!=t.headers?t.headers:new r.Headers(this.headers),body:t&&null!=t.body?t.body:this.body,url:t&&null!=t.url?t.url:this.url,requestTransformer:t&&null!=t.requestTransformer?t.requestTransformer:this.requestTransformer,responseTransformer:t&&null!=t.responseTransformer?t.responseTransformer:this.responseTransformer,params:t&&null!=t.params?"string"==typeof t.params?new r.URLSearchParams(t.params):t.params.clone():this.params,withCredentials:t&&null!=t.withCredentials?t.withCredentials:this.withCredentials,responseType:t&&null!=t.responseType?t.responseType:this.responseType})},e}(r.RequestOptions),B=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.config={baseUrl:"/",headers:new r.Headers,params:new r.URLSearchParams},o.http=e.get(r.Http),o.config.params=o.config.params instanceof r.URLSearchParams?o.config.params:new r.URLSearchParams(o.config.params||""),o}return L(e,t),e.prototype.request=function(t,e){var n=this;return void 0===e&&(e=new N({method:r.RequestMethod.Get})),this.config.headers&&this.config.headers.forEach(function(t,r){e.headers&&!e.headers.has(r)&&e.headers.set(r,t)}),e.params=e.params instanceof r.URLSearchParams?e.params:new r.URLSearchParams(e.params?e.params.toString():""),e.params.setAll(this.config.params),e.body&&(e.requestTransformer||this.config.requestTransformer)&&(e.body=this.transformData(e.body,[this.config.requestTransformer,e.requestTransformer])),this.doRequest(t,e).map(function(t){var o=t;switch(e.responseType){case r.ResponseContentType.ArrayBuffer:o=t.arrayBuffer();break;case r.ResponseContentType.Blob:o=t.blob();break;case r.ResponseContentType.Text:o=t.text();break;case r.ResponseContentType.Json:o=t.json()}return(e.responseTransformer||n.config.responseTransformer)&&(o=n.transformData(o,[n.config.responseTransformer,e.responseTransformer])),o}).catch(function(t){var e=new P;switch(t.status){case 500:e.message=JSON.parse(t.text());break;case 404:e=new E(t.text());break;default:e.message=t.text()||"Server error"}return e.response=t,o.Observable.throw(e)})},e.prototype.doRequest=function(t,e){return void 0===e&&(e={}),e.url=(this.config.baseUrl||"")+t,this.http.request(e.url,e)},e.prototype.get=function(t,e){return e=e||{},e.method=r.RequestMethod.Get,this.request(t,e)},e.prototype.create=function(t,e,n){return n=n||{},n.body=e,n.method=r.RequestMethod.Post,this.request(t,n)},e.prototype.update=function(t,e,n){return n=n||{},n.body=e,n.method=r.RequestMethod.Put,this.request(t,n)},e.prototype.delete=function(t,e){return e=e||{},e.method=r.RequestMethod.Delete,this.request(t,e)},e.prototype.post=function(t,e,r){return this.create(t,e,r)},e.prototype.put=function(t,e,r){return this.update(t,e,r)},e.prototype.patch=function(t,e,n){return n=n||{},n.body=e,n.method=r.RequestMethod.Patch,this.request(t,n)},e.prototype.head=function(t,e){return e=e||{},e.method=r.RequestMethod.Head,this.request(t,e)},e.prototype.options=function(t,e){return e=e||{},e.method=r.RequestMethod.Options,this.request(t,e)},e}(F);B.decorators=[{type:e.Injectable}],B.ctorParameters=function(){return[{type:e.Injector},null]};var G=function(){function t(t){this.options=t||{}}return t.prototype.setEntityManager=function(t){return this.em=t,this},t.prototype.getEntityManager=function(){return this.em},t.prototype.getRequestOptionsFor=function(t){var e=this.options;if(Reflect.has(this.constructor,"__Repository")&&(e=Object.assign({},this.options,Reflect.get(this.constructor,"__Repository"))),e[t])return e[t];if(e.endpoint)return e.endpoint;throw new T("Repository not properly configured. You should provide at least default endpoint configuration")},t.prototype.getAll=function(t){return this.fetchAll(t).toPromise()},t.prototype.getById=function(t,e){return this.fetchById(t,e).toPromise()},t.prototype.getByCriteria=function(t,e){return this.fetchByCriteria(t,e).toPromise()},t}(),V=function(){function t(){this.defaultIncludes=[]}return t.prototype.getIncludeData=function(t,e){for(var r=this.getIncludes(e),n={},o=0,i=r;o<i.length;o++){var s=i[o];try{n[s]=this[this.getIncludeMethodName(s)](t,e)}catch(t){throw new Error("Unable to transform with error "+t.toString())}}return n},t.prototype.getIncludes=function(t){var e=this;t=t||{};var r=n.without(n.uniq(this.defaultIncludes.concat(t.include||[])),t.exclude);return r=r.filter(function(t){return e[e.getIncludeMethodName(t)]})},t.prototype.getIncludeMethodName=function(t){return"include"+i.classify(t)},t}(),H=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),X=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return H(e,t),e.prototype.transform=function(t,e){var o=n.template(t.options.url||"",{interpolate:/{{([\s\S]+?)}}/g}),i=o(Object.assign(Object.create(t.entity),t.entity,t.criteria)),s=new r.URLSearchParams;if(Object.keys(t.criteria).forEach(function(e){s.append(e,t.criteria[e])}),t.options.search){var a=t.options.search instanceof r.URLSearchParams?t.options.search.rawParams:t.options.search;a=n.template(a||"",{interpolate:/{{([\s\S]+?)}}/g})(Object.assign(Object.create(t.entity),t.entity,t.criteria)),s.setAll(new r.URLSearchParams(a))}return{url:i,search:s}},e}(V),Y=function(){function t(t){t instanceof Function?this.transformer=new q(t):this.transformer=t}return t.prototype.transform=function(t,e){for(var r=[],n=0,o=t;n<o.length;n++){var i=o[n];r.push(this.transformer.transform(i,e))}return r},t}(),W=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Q=function(t){function e(e){return t.call(this,e)||this}return W(e,t),Object.defineProperty(e.prototype,"defaultRequestOptions",{get:function(){return{headers:new r.Headers,responseType:r.ResponseContentType.Json}},enumerable:!0,configurable:!0}),e.prototype.getRequestOptionsFor=function(e){var r=t.prototype.getRequestOptionsFor.call(this,e);if(r)throw new T("Repository not properly configured. You should provide at least default endpoint configuration");return function(t,e){return"string"==typeof t?(e.url=t,e):new N(t).merge(e)}(r,this.defaultRequestOptions)},Object.defineProperty(e.prototype,"urlTransformer",{get:function(){return new X},enumerable:!0,configurable:!0}),e.prototype.fetchById=function(t,e){e=e||this.getRequestOptionsFor("get");var r=this.urlTransformer.transform(new M(e,{id:t}));return e.params=r.params,this.getEntityManager().get(r.url,e)},e.prototype.fetchByCriteria=function(t,e){e=e||this.getRequestOptionsFor("search");var r=this.urlTransformer.transform(new M(e,t));return e.search=r.search,e.responseTransformer&&(e.responseTransformer=new Y(e.responseTransformer)),this.getEntityManager().get(r.url,e)},e.prototype.fetchAll=function(t){t=t||this.getRequestOptionsFor("search");var e=this.urlTransformer.transform(new M(t));return t.search=e.search,t.responseTransformer&&(t.responseTransformer=new Y(t.responseTransformer)),this.getEntityManager().get(e.url,t)},e.prototype.save=function(t,e){e=e||this.getRequestOptionsFor(t.id?"update":"create");var r=this.urlTransformer.transform(new M(e,null,t)),n=t.id?"put":"post";return e.params=r.params,this.getEntityManager()[n](r.url,t,e).toPromise()},e.prototype.delete=function(t,e){e=e||this.getRequestOptionsFor("delete");var r=null;"string"!=typeof t&&"number"!=typeof t||(r={id:t});var n=this.urlTransformer.transform(new M(e,r,t));return e.params=n.params,this.getEntityManager().delete(n.url,e).toPromise()},e}(G),K=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),$=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return K(e,t),e.prototype.encodeKey=function(t){return t},e.prototype.encodeValue=function(t){return t},e}(r.QueryEncoder),z=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),J=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return z(e,t),e.prototype.transform=function(t,e){var o=n.template(t.options.url||"",{interpolate:/{{([\s\S]+?)}}/g}),i=o(Object.assign(Object.create(t.entity),t.entity,t.criteria)),s=new r.URLSearchParams(void 0,new $);if(t.options.search){var a=t.options.search instanceof r.URLSearchParams?t.options.search.rawParams:t.options.search;a=n.template(a||"",{interpolate:/{{([\s\S]+?)}}/g})(Object.assign(Object.create(t.entity),t.entity,t.criteria)),s.setAll(new r.URLSearchParams(a))}return{url:i,search:s}},e}(V),Z=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),tt=function(t){function e(e){return t.call(this,e)||this}return Z(e,t),Object.defineProperty(e.prototype,"urlTransformer",{get:function(){return new J},enumerable:!0,configurable:!0}),e.prototype.getRequestOptionsFor=function(e){var r=t.prototype.getRequestOptionsFor.call(this,e),n=t.prototype.getRequestOptionsFor.call(this,"endpoint");return-1!==["get","update","delete"].indexOf(e)&&r.url===n.url&&(r.url+="/{{id}}"),r},e.prototype.save=function(e,r){return r=r||this.getRequestOptionsFor(e.id?"update":"create"),r.requestTransformer=r.requestTransformer||new q(function(t){return delete t.createdAt,delete t.updatedAt,t}),t.prototype.save.call(this,e,r).then(function(t){return e.updatedAt=t.updatedAt,e})},e}(Q),et=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),rt=function(t){function e(e){return t.call(this,e)||this}return et(e,t),e.prototype.getRequestOptionsFor=function(e){var r=t.prototype.getRequestOptionsFor.call(this,e),n=t.prototype.getRequestOptionsFor.call(this,"endpoint");return-1!==["get","update","delete"].indexOf(e)&&r.url===n.url&&(r.url+="/{{id}}"),r},e}(Q),nt=function(){function t(){this.subscribers={}}return t.prototype.dispatch=function(t,e){this.subscribers[t]&&this.subscribers[t].emit(e)},t.prototype.addSubscriber=function(t){var e=this,r=[];return Object.keys(t.subscribedEvents).forEach(function(n){var o=t.subscribedEvents[n];if("string"==typeof o&&(o=t[o]?function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t[t.subscribedEvents[n]].apply(t,e)}:null),!o)throw Error("Unable to subscribe to "+n+" because listener is not defined");r.push(e.addListener(n,o))}),r},t.prototype.addListener=function(t,r){if(!(r&&r instanceof Function))throw Error("Unable to subscribe to "+t+" because provided event listener is not supported");return this.subscribers[t]=this.subscribers[t]||new e.EventEmitter,this.subscribers[t].subscribe(r)},t}(),ot=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),it=new e.OpaqueToken("CORE_EVENT_DISPATCHER"),st=function(t){function e(){return t.call(this)||this}return ot(e,t),e}(nt);st.decorators=[{type:e.Injectable}],st.ctorParameters=function(){return[]};var at=function(){function t(t){this.subject=t}return t}(),ut=function(){function t(){}return t}(),ct=function(){function t(t){this.TCreator=t}return t.prototype.transform=function(t,e){var r=new this.TCreator;return Object.keys(t).forEach(function(e){r[e]=t[e]}),r},t}(),pt=function(){function t(t,e){this.prevToken=t,this.token=e}return t}(),ft=function(){function t(){}return t}(),ht=function(){function t(){}return t}(),lt=function(){function t(){this.roles=[],this.user=new ht}return t.prototype.getUsername=function(){return"Unknown"},t.prototype.getUser=function(){return this.user},t.prototype.hasRole=function(t){return-1!==this.roles.indexOf(t)},t.prototype.isAuthenticated=function(){return!1},t}(),dt=function(){function t(){}return t.prototype.restore=function(){return Promise.reject(null)},t.prototype.logout=function(){},t.prototype.authenticate=function(t){return t.setAuthenticated(!0),Promise.resolve(t)},t.prototype.supports=function(t){return t instanceof mt},t}(),mt=function(){function t(t){this.user=t,this._isAuthenticated=!1,this.roles=[]}return t.prototype.getUser=function(){return this.user},t.prototype.getUsername=function(){return this.getUser().username||"Anonymous"},t.prototype.hasRole=function(t){return-1!==this.roles.indexOf(t)},t.prototype.setAuthenticated=function(t){return void 0===t&&(t=!0),this._isAuthenticated=t,this},t.prototype.isAuthenticated=function(){return this._isAuthenticated},t}(),yt=new e.InjectionToken("USER_SERVICE_AUTH_PROVIDERS"),gt=function(){function t(r){var n=this;this.injector=r,this.onUserChanged=new e.EventEmitter,this.onAuthRequired=new e.EventEmitter,this.userToken=new lt,this.eventDispatcher=r.get(st,null),this.onAuthRequired.subscribe(function(e){n.eventDispatcher&&n.eventDispatcher.dispatch(t.EVENTS.ON_AUTH_REQUIRED,e)})}return t.prototype.getUserToken=function(){return this.userToken},t.prototype.getProviders=function(){return this.injector.get(yt,[])},t.prototype.getUser=function(){return this.getUserToken().getUser()},t.prototype.authenticate=function(t){var e=this,r=this.getProviders().find(function(e){return e.supports(t)});if(!r)throw new R("Token not supported");return r.authenticate(t).then(function(t){return e.providerOnAuthTokenChangedSubscription&&e.providerOnAuthTokenChangedSubscription.unsubscribe(),r.onAuthTokenChanged&&(e.providerOnAuthTokenChangedSubscription=r.onAuthTokenChanged.subscribe(function(t){e.setToken(t)})),e.setToken(t)})},t.prototype.setToken=function(e){var r=this.getUserToken();if(r!==e){this.userToken=e;var n=new pt(r,this.getUserToken());return this.onUserChanged.emit(n),this.eventDispatcher&&this.eventDispatcher.dispatch(t.EVENTS.ON_USER_CHANGED,n),this.userToken}},t.prototype.logout=function(){var t=this;return Promise.all(this.getProviders().map(function(t){return t.logout()})).then(function(e){e.pop();return t.setToken(new lt)},function(){return t.setToken(new lt)})},t.prototype.reload=function(){var t=this;return this.userToken=new lt,Promise.all(this.getProviders().map(function(t){return t.restore()})).then(function(e){var r=e.pop();return t.setToken(r)},function(){return Promise.resolve()})},t}();gt.EVENTS={ON_USER_CHANGED:"ON_USER_CHANGED",ON_AUTH_REQUIRED:"ON_AUTH_REQUIRED"},gt.decorators=[{type:e.Injectable}],gt.ctorParameters=function(){return[{type:e.Injector}]};var vt=function(){function t(t){this.userService=t}return t.prototype.resolve=function(t,e){return this.userService.reload()},t}();vt.decorators=[{type:e.Injectable}],vt.ctorParameters=function(){return[{type:gt}]};var bt=function(){function t(t){this.userService=t}return t.prototype.canActivate=function(){return this.userService.getUserToken().isAuthenticated()},t}();bt.decorators=[{type:e.Injectable}],bt.ctorParameters=function(){return[{type:gt}]};var _t=function(){function t(t){this.userService=t}return t.prototype.canActivateChild=function(){return this.userService.getUserToken().isAuthenticated()},t}();_t.decorators=[{type:e.Injectable}],_t.ctorParameters=function(){return[{type:gt}]};var wt=function(){function t(t){this.userService=t,this.roles=[]}return t.prototype.canActivate=function(){for(var t=this.userService.getUserToken(),e=0;e<this.roles.length;e++)if(!t.hasRole(this.roles[e]))return!1;return!0},t}();wt.decorators=[{type:e.Injectable}],wt.ctorParameters=function(){return[{type:gt}]};var Pt=function(){function t(t){this.userService=t,this.roles=[]}return t.prototype.canActivateChild=function(){for(var t=this.userService.getUserToken(),e=0;e<this.roles.length;e++)if(!t.hasRole(this.roles[e]))return!1;return!0},t}();Pt.decorators=[{type:e.Injectable}],Pt.ctorParameters=function(){return[{type:gt}]};var Et=function(){function t(t,e){this.authUrl=t,this.http=e}return t.prototype.authenticate=function(t){return this.http.get(this.authUrl,{search:new r.URLSearchParams("username="+t.username+"&password="+t.password)}).toPromise().then(function(e){var r=e.json(),n=new Rt(r);return t.setUser(n),t}).catch(function(e){return Promise.reject(new O(t,e.message,e))})},t.prototype.supports=function(t){return t instanceof Tt},t.prototype.restore=function(){return Promise.reject(null)},t.prototype.logout=function(){return Promise.resolve(new lt)},t}(),Rt=function(){function t(t){Object.assign(this,t)}return t}(),Tt=function(){function t(t,e){this.username=t,this.password=e,this.roles=[],this.user=new Rt({username:t})}return t.prototype.getUser=function(){return this.user},t.prototype.getUsername=function(){return this.getUser().username},t.prototype.hasRole=function(t){return-1!==this.roles.indexOf(t)},t.prototype.setUser=function(t){return this.user=t,this},t.prototype.isAuthenticated=function(){return!(this.user instanceof ht)},t}(),At=function(){function t(){}return t.readCookie=function(t){var e=new RegExp("(?:^|; )"+encodeURIComponent(t)+"=([^;]*)").exec(document.cookie);return e?e[1]:null},t.writeCookie=function(t,e,r){r||(r=7300);var n=new Date;n.setTime(n.getTime()+24*r*60*60*1e3);var o="; expires="+n.toUTCString();document.cookie=t+"="+e+o+"; path=/"},t.removeCookie=function(t){this.writeCookie(t,"",-1)},t}(),Ot=function(){function t(t,e){this.options=t,this.http=e}return t.prototype.supports=function(t){return t instanceof Tt},t.prototype.authenticate=function(t){return this.http.get(this.options.authUrl,{params:new r.URLSearchParams("username="+t.username+"&password="+t.password),headers:new r.Headers({"X-Parse-Application-Id":this.options.X_Parse_Application_Id,"X-Parse-REST-API-Key":this.options.X_Parse_REST_API_Key})}).toPromise().then(function(t){var e=t.json(),r=new Ct(e);return At.writeCookie("ParseAuthProvider_remeberme",e),r}).catch(function(e){var r=e.json();return Promise.reject(new O(t,r.message,r))})},t.prototype.restore=function(){var t=this,e=At.readCookie("ParseAuthProvider_remeberme");return(e?Promise.resolve(new Ct(e)):Promise.reject(null)).then(function(e){return t.http.get(t.options.baseUrl+"/users/me",{headers:new r.Headers({"X-Parse-Application-Id":t.options.X_Parse_Application_Id,"X-Parse-REST-API-Key":t.options.X_Parse_REST_API_Key,"X-Parse-Session-Token":e.sessionToken})}).toPromise().then(function(t){return e}).catch(function(t){return Promise.reject(null)})})},t.prototype.logout=function(){return At.removeCookie("ParseAuthProvider_remeberme"),Promise.resolve(new lt)},t}(),Ct=function(){function t(t){var e=this;this.roles=[],this.user={},Object.keys(t).forEach(function(r){e.user[r]=t[r]})}return t.prototype.getUser=function(){return this.user},t.prototype.getUsername=function(){return this.getUser().username},t.prototype.hasRole=function(t){return-1!==this.roles.indexOf(t)},t.prototype.setUser=function(t){return this.user=t,this},t.prototype.isAuthenticated=function(){return!!this.getUser().sessionToken},t}(),Ut=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),kt=function(){function t(t){var e=this;this.firebase_auth=t,this.onAuthTokenChanged=o.Observable.create(function(r){t.onAuthStateChanged(function(t){t?(e.user=t,r.next(t.isAnonymous?new jt(t):new It(t)),t.getToken().then(function(t){At.writeCookie("FirebaseAuthProvider_token",t)})):(At.removeCookie("FirebaseAuthProvider_token"),e.user=null,r.next(new lt))})})}return t.prototype.supports=function(t){return t instanceof Tt||t instanceof St||t instanceof jt||t instanceof It},t.prototype.authenticate=function(t){return this.doAuthenticate(t).then(function(t){return t}).catch(function(t){return Promise.reject(t)})},t.prototype.doAuthenticate=function(t){return t instanceof Tt?this.authenticateByUsernamePassword(t):t instanceof St?this.authenticateByOAuthService(t):this.user&&t instanceof It?this.authenticateWithExisted(t):this.authenticateAnonymously(t)},t.prototype.authenticateWithExisted=function(t){var e=this;return new Promise(function(r,n){return e.user?r(t):n(new O(t,"User not really signed in. Try reload the app."))})},t.prototype.authenticateAnonymously=function(t){var e=this;return new Promise(function(r,n){e.firebase_auth.signInAnonymously().then(function(t){r(new jt(t))}).catch(function(e){n(new O(t,e.message,e))})})},t.prototype.authenticateByUsernamePassword=function(t){var e=this;return new Promise(function(r,n){if(e.user){var o=firebase.auth.EmailAuthProvider.credential(t.getUsername(),t.password);e.firebase_auth.currentUser.linkWithCredential(o).then(function(t){return r(new It(t))},function(i){"auth/email-already-in-use"===i.code?e.user.reauthenticateWithCredential(o).then(function(t){r(new It(t))}).catch(function(e){n(new O(t,e.message,e))}):n(new O(t,i.message,i))})}else e.firebase_auth.signInWithEmailAndPassword(t.getUsername(),t.password).then(function(t){r(new It(t))}).catch(function(e){n(new O(t,e.message,e))})})},t.prototype.authenticateByOAuthService=function(t){var e=this;return new Promise(function(r,n){if(e.user){var o=t.socialProvider.credential(t.socialProvider);e.firebase_auth.currentUser.linkWithCredential(o).then(function(t){return r(new It(t))},function(e){n(new O(t,e.message,e))})}else e.firebase_auth.signInWithPopup(t.socialProvider).then(function(t){var e=t.credential.accessToken,n=t.user;n.facebookAccessToken=e,r(new It(n))}).catch(function(e){n(new O(t,e.message,e))})})},t.prototype.restore=function(){var t=this;return new Promise(function(e,r){if(t.user)return e(new It(t.user));var n=t.onAuthTokenChanged.subscribe(function(t){n.unsubscribe(),clearTimeout(o),e(t)}),o=setTimeout(function(){n.unsubscribe(),r(null)},5e3)})},t.prototype.logout=function(t){var e=this;return new Promise(function(r,n){e.firebase_auth.signOut().then(function(){delete this.user,r(new lt)}).catch(function(e){n(t)})})},t}(),It=function(){function t(t){this.roles=[],this.user=t}return t.prototype.getUser=function(){return this.user},t.prototype.getUsername=function(){
return this.getUser().email},t.prototype.hasRole=function(t){return-1!==this.roles.indexOf(t)},t.prototype.setUser=function(t){return this.user=t,this},t.prototype.isAuthenticated=function(){return!!this.getUser()},t}(),jt=function(t){function e(e){var r=t.call(this,e)||this;return r.roles=["anonymous"],r}return Ut(e,t),e.prototype.isAuthenticated=function(){return!0},e}(It),St=function(t){function e(e,r){var n=t.call(this,e)||this;return n.socialProvider=r,n}return Ut(e,t),e.prototype.isAuthenticated=function(){return!0},e}(It),Mt=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[gt,st,vt,bt,_t,wt,Pt]}},t}();Mt.decorators=[{type:e.NgModule}],Mt.ctorParameters=function(){return[]};var qt=function(){function t(){this._isLoading=!1,this.loadingChange=new e.EventEmitter}return Object.defineProperty(t.prototype,"loading",{get:function(){return this._isLoading},set:function(t){this._isLoading=t,this.loadingChange.emit(t)},enumerable:!0,configurable:!0}),t.prototype.show=function(){this.loading=!0},t.prototype.hide=function(){this.loading=!1},t}();qt.decorators=[{type:e.Component,args:[{selector:"loading",styles:["\n\n.loading-component {\n  position: absolute;\n  display: block;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 0;\n  background: rgba(0, 0, 0, 0.1);\n  z-index: 1000;\n}\n.loading-component .loading-spinner {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 50px;\n  height: 40px;\n  text-align: center;\n  font-size: 10px;\n}\n.loading-component .loading-spinner > div {\n  background-color: #007cbb;\n  height: 100%;\n  width: 6px;\n  display: inline-block;\n  -webkit-animation: sk-stretchdelay 1.2s infinite ease-in-out;\n  animation: sk-stretchdelay 1.2s infinite ease-in-out;\n}\n.loading-component .loading-spinner .rect2 {\n  -webkit-animation-delay: -1.1s;\n  animation-delay: -1.1s;\n}\n.loading-component .loading-spinner .rect3 {\n  -webkit-animation-delay: -1.0s;\n  animation-delay: -1.0s;\n}\n.loading-component .loading-spinner .rect4 {\n  -webkit-animation-delay: -0.9s;\n  animation-delay: -0.9s;\n}\n.loading-component .loading-spinner .rect5 {\n  -webkit-animation-delay: -0.8s;\n  animation-delay: -0.8s;\n}\n@-webkit-keyframes sk-stretchdelay {\n  0%, 40%, 100% {\n    -webkit-transform: scaleY(0.4);\n  }\n  20% {\n    -webkit-transform: scaleY(1);\n  }\n}\n@keyframes sk-stretchdelay {\n  0%, 40%, 100% {\n    transform: scaleY(0.4);\n    -webkit-transform: scaleY(0.4);\n  }\n  20% {\n    transform: scaleY(1);\n    -webkit-transform: scaleY(1);\n  }\n}\n\n"],template:'\n<div *ngIf="_isLoading" class="loading-component">\n  <div class="loading-spinner">\n    <div class="rect1"></div>\n    <div class="rect2"></div>\n    <div class="rect3"></div>\n    <div class="rect4"></div>\n    <div class="rect5"></div>\n  </div>\n</div>\n'}]}],qt.ctorParameters=function(){return[]},qt.propDecorators={loading:[{type:e.Input}],loadingChange:[{type:e.Output}]};var Dt=function(){function t(t){this.$element=t,this.loadingChange=new e.EventEmitter}return Object.defineProperty(t.prototype,"loading",{get:function(){return this.$element.nativeElement.classList.contains(t.LOADING_CLASS_NAME)},set:function(e){e?this.$element.nativeElement.classList.add(t.LOADING_CLASS_NAME):this.$element.nativeElement.classList.remove(t.LOADING_CLASS_NAME),this.loadingChange.emit(e)},enumerable:!0,configurable:!0}),t.prototype.show=function(){this.loading=!0},t.prototype.hide=function(){this.loading=!1},t}();Dt.LOADING_CLASS_NAME="loading-in-progress",Dt.decorators=[{type:e.Directive,args:[{selector:"[loading]"}]}],Dt.ctorParameters=function(){return[{type:e.ElementRef}]},Dt.propDecorators={loading:[{type:e.Input}],loadingChange:[{type:e.Output}]};var xt=function(){function t(t,e){void 0===e&&(e=[]),this.TCreator=t,this.fields=e,this.name="default"}return Object.defineProperty(t.prototype,"formGroup",{get:function(){return this._formGroup},enumerable:!0,configurable:!0}),t.prototype.buildForm=function(t,e){var r={},o=m(this.TCreator,this.name),i=g(this.TCreator,this.name),a=n.uniq(Object.keys(t).concat(this.fields));return n.forEach(a,function(e){r[e]=new s.FormControl(t[e],o[e],i[e])}),this._formGroup=new s.FormGroup(r),this._formGroup},t.prototype.getEntity=function(t,e){if(void 0===t&&(t=!1),!t&&this._formGroup.invalid)throw new Error("Form is not valid");var r=new x,n=new D([new q(function(t){return t.getRawValue()}),new ct(this.TCreator)]);return r.createData(this._formGroup,n,e)},t}(),Ft=function(){function t(t){this.formGroup=t}return t.prototype.ngOnInit=function(){},t.prototype.getMessagesByName=function(t){return this.messages&&t?this.messages[t]:null},t}();Ft.decorators=[{type:e.Directive,args:[{selector:"[formErrorMessages]"}]}],Ft.ctorParameters=function(){return[{type:s.FormGroupDirective}]},Ft.propDecorators={messages:[{type:e.Input,args:["formErrorMessages"]}]};var Lt=function(){function t(t){this.errorMessagesDirective=t,this.maxErrorsCount=1}return t.prototype.ngOnInit=function(){},Object.defineProperty(t.prototype,"errorMessages",{get:function(){return this._errorMessages?this._errorMessages:this.errorMessagesDirective?this.errorMessagesDirective.getMessagesByName(this.control.name||this.name):void 0},enumerable:!0,configurable:!0}),t}();Lt.decorators=[{type:e.Component,args:[{selector:"field",template:'\n\n<div class="field-group" [ngClass]="{\'has-error\': control && !control.valid && control.touched}">\n  <label *ngIf="label" class="control-label" [for]="name">{{label}}</label>\n  <div class="control-container">\n    <div class="widget">\n      <ng-content></ng-content>\n    </div>\n    <field-errors #fieldErrors [messages]="errorMessages" [maxErrorsCount]="maxErrorsCount" [control]="control"></field-errors>\n  </div>\n</div>\n\n',styleUrls:[]}]}],Lt.ctorParameters=function(){return[{type:Ft}]},Lt.propDecorators={label:[{type:e.Input}],maxErrorsCount:[{type:e.Input}],_errorMessages:[{type:e.Input,args:["errorMessages"]}],name:[{type:e.Input}],fieldErrors:[{type:e.ViewChild,args:["fieldErrors"]}],control:[{type:e.ContentChild,args:[s.FormControlDirective]}]};var Nt={REQUIRED:"Required",DEFAULT:"Invalid field"},Bt=function(){function t(t,e){this.element=t,this.formGroup=e}return t.prototype.ngAfterViewInit=function(){var t=this.element.nativeElement.getAttribute("name");!this.control&&t&&this.formGroup&&(this.control=this.formGroup.form.controls[t]),this.control||this.element.nativeElement.addStyles(["display: none"])},Object.defineProperty(t.prototype,"errors",{get:function(){if((!this.maxErrorsCount||0!==this.maxErrorsCount)&&this.control&&this.control.touched&&this.control.errors){for(var t=Object.keys(this.control.errors),e=[],r=this.maxErrorsCount||5,n=0;n<r&&t[n];n++)e.unshift(this.getMessageFor(t[n]));return e}},enumerable:!0,configurable:!0}),t.prototype.getMessageFor=function(t){return this.messages?this.messages[t.toUpperCase()]||this.messages:Nt[t.toUpperCase()]||Nt.DEFAULT},t}();Bt.decorators=[{type:e.Component,args:[{selector:"field-errors",template:'\n\n<div *ngIf="errors" class="errors-container">\n  <ul>\n    <li *ngFor="let e of errors" class="error">{{e}}</li>\n  </ul>\n</div>\n\n',styles:["\n.errors-container li {\n  list-style: none;\n}\n\n"]}]}],Bt.ctorParameters=function(){return[{type:e.ElementRef},{type:s.FormGroupDirective}]},Bt.propDecorators={control:[{type:e.Input}],maxErrorsCount:[{type:e.Input}],messages:[{type:e.Input}]};var Gt=function(){function t(t,e){this.element=t,this.errorMessagesDirective=e}return Object.defineProperty(t.prototype,"errors",{get:function(){if(!this.group)return[];for(var t=Object.keys(this.group.controls),e=[],r=0;r<t.length;r++){var o=this.group.controls[t[r]];if(o.touched&&o.errors){var i=n.keys(o.errors);e.unshift(this.getMessageFor(t[r],i[0]))}}return e},enumerable:!0,configurable:!0}),t.prototype.getMessageFor=function(t,e){if(this.messages&&this.messages[t])return this.messages[t][e.toUpperCase()]||this.messages[t];if(this.errorMessagesDirective){var r=this.errorMessagesDirective.getMessagesByName(t);if(r)return r[e.toUpperCase()]||r}return i.humanize(t)+": "+(Nt[e.toUpperCase()]||Nt.DEFAULT)},t}();Gt.decorators=[{type:e.Component,args:[{selector:"form-group-errors",template:'\n    <div *ngIf="errors" class="errors-container">\n      <ul>\n        <li *ngFor="let e of errors" class="error">{{e}}</li>\n      </ul>\n    </div>\n',styles:["\n\n.errors-container li {\n  list-style: none;\n}\n\n"]}]}],Gt.ctorParameters=function(){return[{type:e.ElementRef},{type:Ft}]},Gt.propDecorators={group:[{type:e.Input}],messages:[{type:e.Input}]};var Vt={imports:[a.CommonModule,u.BrowserModule,s.ReactiveFormsModule,s.FormsModule],declarations:[Lt,Gt,Bt,Ft,Dt,qt],entryComponents:[],exports:[Lt,Bt,Gt,Ft,Dt,qt]},Ht=function(){function t(){}return t}();Ht.decorators=[{type:e.NgModule,args:[Vt]}],Ht.ctorParameters=function(){return[]},t.NotFoundException=_,t.DuplicateEntityException=w,t.HttpException=P,t.HttpNotFoundException=E,t.LogicException=R,t.InvalidConfigurationException=T,t.RuntimeException=A,t.AuthenticationException=O,t.CRUDListResolver=C,t.CRUDInteractor=U,t.CRUDItemResolver=k,t.CRUDItemEditComponent=I,t.CRUDListComponent=j,t.EMRequestOptions=S,t.Criterion=M,t.getEntityDecoratorConfiguration=c,t.Entity=p,t.getRepositoryDecoratorConfiguration=f,t.Repository=h,t.getEmDecoratorConfiguration=l,t.EM=d,t.getValidatorDecoratorConfiguration=m,t.Validator=y,t.getValidatorAsyncDecoratorConfiguration=g,t.ValidatorAsync=v,t.EntityManager=F,t.HttpEMRequestOptions=N,t.HttpEntityManager=B,t.BaseRepository=G,t.HttpRepository=Q,t.ParseBaseRepository=tt,t.RESTBaseRepository=rt,t.CriterionToUrlTransformer=X,t.ParseCriterionToUrlTransformer=J,t.ParseQueryEncoder=$,t.CORE_EVENT_DISPATCHER=it,t.CoreEventDispatcherService=st,t.Event=at,t.EventDispatcher=nt,t.ChainTransformer=D,t.CollectionTransformer=Y,t.TransformerOptions=ut,t.FunctionTransformer=q,t.ItemTransformerAbstract=V,t.TransformManager=x,t.ToTypeTransformer=ct,t.UserChangedEvent=pt,t.UserAuthEvent=ft,t.AnonymusUser=ht,t.AnonymousUserToken=lt,t.ManualAuthProvider=dt,t.ManualUserToken=mt,t.UserRestoreResolver=vt,t.USER_SERVICE_AUTH_PROVIDERS=yt,t.UserService=gt,t.UserAuthenticatedCanActivateRouterGuard=bt,t.UserAuthenticatedCanActivateChildRouterGuard=_t,t.UserRolesAllowedCanActivateRouterGuard=wt,t.UserRolesAllowedCanActivateChildRouterGuard=Pt,t.ParseAuthProvider=Ot,t.ParseAuthToken=Ct,t.UsernamePasswordAuthProvider=Et,t.BasicUser=Rt,t.UsernamePasswordToken=Tt,t.FirebaseAuthProvider=kt,t.FirebaseAuthToken=It,t.FirebaseAnonymusAuthToken=jt,t.FirebaseSocialAuthToken=St,t.CoreBundleModule=Mt,t.LoadingComponent=qt,t.LoadingDirective=Dt,t.BasicFormType=xt,t.FieldComponent=Lt,t.FieldErrorsComponent=Bt,t.FormGroupErrorsComponent=Gt,t.UIBundleModuleConfig=Vt,t.UIBundleModule=Ht,Object.defineProperty(t,"__esModule",{value:!0})});
